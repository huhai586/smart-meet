import {Button, Empty, FloatButton} from "~node_modules/antd";import React, {useEffect, useMemo, useRef, useState} from "react";import useTranscripts from "../../hooks/useTranscripts";import CaptionList from "./captionList";import './captions.scss';import getMeetingCaptions from "../../utils/getCaptions";import useScroll from "../../hooks/useScroll";import {ScrollDirection} from "../../utils/is-scroll-to-bottom";import {Alert} from "antd";import scrollToBottom from "~utils/scroll-to-bottom";const Captions = (props) => {    const [initialCaptionsLength, setInitialCaptionsLength] = useState(0);    const container = useRef(null);    const chatContainer = useRef(null);    const [isAutoScroll, setAutoScroll] = useState(true);    const [speakers, setSpeakers] = useState([]);    const [scrollInfo] = useScroll(chatContainer.current)    const [filterSpeaker, setFilterSpeakers] = useState([]);    const [transcripts] = useTranscripts();    const [isInit, setIsInit] = useState(true);    useEffect(() => {        getMeetingCaptions().then((res) => {            setInitialCaptionsLength(res.length);        });    }, []);    useEffect(() => {        const speakers = [...new Set(transcripts.map((item) => item.activeSpeaker))] ;        setSpeakers(speakers);    }, [transcripts]);    const getTranscripts = () => {        if (filterSpeaker.length === 0) {return transcripts;}        return transcripts.filter((v) => {            return filterSpeaker.includes(v.activeSpeaker)        });    }    const toggleSpeaker = (speaker: string) => {        if (filterSpeaker.includes(speaker)) {            setFilterSpeakers(filterSpeaker.filter((v) => v !== speaker));        } else {            setFilterSpeakers([...filterSpeaker, speaker]);        }    }    useEffect(() => {        if (!isInit) return        setIsInit(initialCaptionsLength === transcripts.length);    }, [transcripts, initialCaptionsLength, isInit]);    const data = useMemo(() => {        return getTranscripts();    }, [transcripts, filterSpeaker]);    const isNoData = data.length === 0;    useEffect(() => {        console.log(isInit, isAutoScroll, 'isInit, isAutoScroll');        if (isInit || !isAutoScroll) {return}        // scroll to bottom smoothly        setTimeout(() => {            scrollToBottom(chatContainer.current);        }, 100)    }, [data, chatContainer, isInit, isAutoScroll]);    useEffect(() => {        if (scrollInfo.direction === ScrollDirection.UP) {            setAutoScroll(false); // stop auto scroll, Because user is scrolling by themselves        } else if (scrollInfo.reachBottom){            setAutoScroll(true);        }    }, [scrollInfo]);    console.log(isAutoScroll, '1212');    return (        <div className={`captions`} ref={container}>            <div className="filter-speakers">                {speakers.length > 0 && "filter:"}                {speakers.map((speaker) => (                    <Button color="default" variant={filterSpeaker.includes(speaker) ? 'solid' : 'outlined'} size={'small'} onClick={() => {toggleSpeaker(speaker)}} key={speaker}>                        {speaker}                    </Button>                ))}            </div>            <div className={`chat-container ${isNoData ? 'no-data' : ''}`} ref={chatContainer}>                {data.length > 0 ? (                    <CaptionList listData={data}/>                ) : (                    <Empty></Empty>                )}            </div>            <div className={`auto-scroll-notifier ${isAutoScroll ? 'hide' : 'none'}`}>                <Alert                    closable                    banner                    message={<div className={'enable-auto-scroll'} onClick={() => {                        setAutoScroll(true);                    }}>Automatic scrolling function is paused, scroll to bottom to resume</div>}                />            </div>            <FloatButton.BackTop visibilityHeight={100} target={ () => document.querySelector('.chat-container') as HTMLElement}/>        </div>    )}export default Captions;